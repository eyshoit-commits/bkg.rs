# bkg.rs v0.2 – Phase 1 Fortschrittsnotiz

**Datum:** 2025-10-21

Diese Notiz dokumentiert die Umsetzung der Candle- und RustyFace-Plug-ins sowie die Erweiterungen der Plugin-Lifecycle-Schnittstellen.

## Neue Plug-ins

### Candle (Rust)
- Implementiert als eigenständiges Binary (`bkg-candle`).
- Unterstützt Capabilities `candle.model.load`, `candle.model.run`, `candle.stats`.
- Lädt lineare Modelle aus JSON-Dateien, führt Inferenz mittels [candle-core](https://github.com/huggingface/candle) aus und streamt Telemetriedaten (CPU, RAM, geladene Modelle).
- HTTP-Endpoints für Healthchecks und lokale Model-Tests (`/health`, `/models`, `/models/:id/run`).

### RustyFace (Rust)
- Capabilities `faces.encode`, `faces.search`, `dataset.manage`.
- Dekodiert Bilder (PNG/JPEG etc.), erzeugt normalisierte 32x32-Embeddings und verwaltet persistente Datensätze (JSON-basiert).
- Bietet Health-/Dataset-APIs und Telemetrie (Datensatz-/Eintragsanzahl, Ressourcenverbrauch).

Beide Plug-ins verwenden den Plugin-Bus für Registrierung, Log-Streaming, Telemetrie und Health-Events.

## Backend-Erweiterungen

- Neues REST-Modul `/api/plugins` für Lifecycle-Operationen (Start, Stop, Restart), Konfigurationsupdates, Log-Backfill und Telemetrieabfragen.
- WebSocket-Gateway `/ws/plugins` für Echtzeit-Status, Logs und Telemetrie; Clients können Topics abonnieren (`status`, `logs`, `telemetry`).
- Plugin-Bus speichert Log-Historie (Ringpuffer) und Telemetrie-Snapshots, Events werden an HTTP- und WS-Schichten propagiert.
- Admin-Controller ergänzt um Restart-Route.
- `PluginCapability`-Union um Candle- und RustyFace-spezifische Capabilities erweitert.

## Frontend (Angular)

- Neues `PluginWsService`, das den WebSocket konsumiert, Bootstrap-Daten verteilt und Subscriptions für Status/Logs/Telemetrie bereitstellt.
- Plugin-Dashboard zeigt Live-Status, Logstream und Telemetrie-Statistiken (CPU, Speicher, Modelle/Datensätze).
- Plugin-Übersicht nutzt Echtzeit-Status-Events; Logstream basiert auf WS statt SSE.
- API-Service richtet sich auf neue `/api/plugins`-Routen aus.

## Konfigurationsänderungen

- `plugins/plugins.json` enthält die Candle- und RustyFace-Konfiguration inklusive Healthchecks.
- Package-Update: `@nestjs/websockets` & `@nestjs/platform-ws` im API-Server.
- Rust-Crates für Candle/RustyFace inklusive `start.sh`-Skripten und Beispielressourcen.

## Offene Punkte

- Model-Download-/Validierungs-API (`/api/models`) folgt in Phase 1 verbleibenden Tasks.
- CI-Linting migrieren (Angular CLI nutzt aktuell deprecated TSLint-Builder).
- Ergänzende Tests (Unit/E2E) für neue Controller und Gateway.

