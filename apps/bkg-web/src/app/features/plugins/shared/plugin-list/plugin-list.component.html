<section class="space-y-6">
  <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h2 class="text-xl font-semibold text-white">Plug-in Übersicht</h2>
      <p class="text-sm text-slate-400">Verwalte Laufzeit, Fähigkeiten und Dashboards aller registrierten Plug-ins.</p>
      <p class="mt-1 text-xs uppercase tracking-wide text-slate-500">
        Aktive Plug-ins: {{ plugins.length }} · Kuratierte Features: {{ totalFeatureCount }}
      </p>
    </div>
    <button
      class="px-4 py-2 rounded bg-primary text-white text-sm font-semibold disabled:opacity-60"
      (click)="refresh()"
      [disabled]="loading"
    >
      {{ loading ? 'Aktualisiere…' : 'Aktualisieren' }}
    </button>
  </header>

  <p *ngIf="error" class="rounded border border-rose-700/60 bg-rose-900/40 text-rose-200 px-4 py-3 text-sm">{{ error }}</p>

  <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-3">
    <a
      *ngFor="let plugin of plugins"
      [routerLink]="['/plugins', plugin.name]"
      class="group flex flex-col justify-between rounded-2xl border border-slate-800/80 bg-slate-950/80 p-5 transition hover:border-primary/80 hover:bg-primary/5"
    >
      <div class="space-y-4">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h3 class="text-lg font-semibold text-white">{{ plugin.config?.name || plugin.name }}</h3>
            <p class="text-sm text-slate-400">{{ plugin.config?.description || 'Konfiguration fehlt' }}</p>
          </div>
          <span
            class="px-3 py-1 rounded-full text-xs font-semibold"
            [ngClass]="{
              'bg-emerald-500/20 text-emerald-200': plugin.status === 'running',
              'bg-amber-500/20 text-amber-200': plugin.status === 'starting',
              'bg-rose-500/20 text-rose-200': plugin.status === 'error' || plugin.status === 'stopped'
            }"
          >
            {{ plugin.status }}
          </span>
        </div>
        <div class="flex flex-wrap gap-2 text-[11px] uppercase tracking-wide text-slate-300">
          <span *ngFor="let capability of plugin.capabilities" class="rounded-full bg-slate-800/80 px-3 py-1 text-xs">
            {{ capability }}
          </span>
        </div>
        <dl class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs text-slate-400">
          <div>
            <dt class="uppercase tracking-wide text-slate-500">Port</dt>
            <dd class="text-slate-200">{{ plugin.port ?? 'intern' }}</dd>
          </div>
          <div>
            <dt class="uppercase tracking-wide text-slate-500">Autostart</dt>
            <dd class="text-slate-200">{{ plugin.config?.autostart ? 'aktiv' : 'manuell' }}</dd>
          </div>
          <div>
            <dt class="uppercase tracking-wide text-slate-500">Features</dt>
            <dd class="text-slate-200">{{ featureCount(plugin) }}</dd>
          </div>
        </dl>
      </div>
      <div class="mt-5 flex items-center justify-between text-xs text-slate-400">
        <div class="flex gap-2">
          <button
            class="rounded bg-emerald-600/80 px-3 py-1 font-semibold text-white hover:bg-emerald-600"
            (click)="start(plugin, $event)"
          >
            Start
          </button>
          <button
            class="rounded bg-rose-600/80 px-3 py-1 font-semibold text-white hover:bg-rose-600"
            (click)="stop(plugin, $event)"
          >
            Stop
          </button>
        </div>
        <span class="font-medium text-primary/80 group-hover:text-primary">Dashboard öffnen →</span>
      </div>
    </a>
  </div>
</section>
