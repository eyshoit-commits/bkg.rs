<div class="space-y-6" *ngIf="plugin; else selectPlugin">
  <header class="flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
    <div>
      <h2 class="text-2xl font-semibold text-white">{{ plugin?.config?.name || plugin?.name }}</h2>
      <p class="text-sm text-slate-400">{{ plugin?.config?.description }}</p>
    </div>
    <div class="flex flex-wrap items-center gap-3">
      <span
        class="rounded-full px-3 py-1 text-xs font-semibold"
        [ngClass]="{
          'bg-emerald-500/20 text-emerald-200': plugin?.status === 'running',
          'bg-amber-500/20 text-amber-200': plugin?.status === 'starting',
          'bg-rose-500/20 text-rose-200': plugin?.status === 'stopped' || plugin?.status === 'error'
        }"
      >
        {{ plugin?.status }}
      </span>
      <span class="rounded bg-slate-800/80 px-3 py-1 text-xs text-slate-300">Port: {{ plugin?.port ?? 'intern' }}</span>
      <button class="rounded bg-emerald-600/80 px-3 py-2 text-xs font-semibold text-white hover:bg-emerald-600" (click)="start()">
        Start
      </button>
      <button class="rounded bg-rose-600/80 px-3 py-2 text-xs font-semibold text-white hover:bg-rose-600" (click)="stop()">
        Stop
      </button>
      <button class="rounded bg-primary px-3 py-2 text-xs font-semibold text-white hover:bg-primary/90" (click)="restart()">
        Restart
      </button>
      <button class="rounded border border-slate-700 px-3 py-2 text-xs font-semibold text-slate-200 hover:bg-slate-800" (click)="refresh()">
        Refresh
      </button>
    </div>
  </header>

  <p *ngIf="error" class="rounded border border-rose-700/60 bg-rose-900/40 px-4 py-3 text-sm text-rose-200">{{ error }}</p>

  <div class="grid gap-6 lg:grid-cols-[260px_1fr]">
    <aside class="space-y-4 rounded-2xl border border-slate-800/80 bg-slate-950/80 p-4">
      <div class="flex items-center justify-between">
        <h3 class="text-sm font-semibold uppercase tracking-wide text-slate-300">Plug-ins</h3>
        <a routerLink="/plugins" class="text-xs font-medium text-primary hover:text-primary/80">Zur Übersicht</a>
      </div>
      <nav class="space-y-1">
        <a
          *ngFor="let entry of plugins"
          [routerLink]="['/plugins', entry.name]"
          class="block rounded-lg px-3 py-2 text-sm"
          [ngClass]="{
            'bg-primary/20 text-primary-foreground font-semibold': entry.name === plugin?.name,
            'text-slate-300 hover:bg-slate-900/80': entry.name !== plugin?.name
          }"
        >
          {{ entry.config?.name || entry.name }}
        </a>
      </nav>
    </aside>

    <section class="space-y-6">
      <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 p-5">
        <h3 class="text-lg font-semibold text-white">Fähigkeiten</h3>
        <p class="text-sm text-slate-400">Capabilities werden automatisch vom Plug-in gemeldet.</p>
        <div class="mt-3 flex flex-wrap gap-2">
          <span
            *ngFor="let capability of plugin?.capabilities; trackBy: trackCapability"
            class="rounded-full bg-slate-800/80 px-3 py-1 text-xs uppercase tracking-wide text-slate-200"
          >
            {{ capability }}
          </span>
        </div>
      </div>

      <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 p-5">
        <h3 class="text-lg font-semibold text-white">Steuerung & Features</h3>
        <p class="text-sm text-slate-400">Schnellzugriff auf die wichtigsten Steuerfunktionen dieses Plug-ins.</p>
        <ul class="mt-4 space-y-3">
          <li *ngFor="let feature of features" class="rounded-lg border border-slate-800/80 bg-black/20 p-4">
            <h4 class="text-sm font-semibold text-white">{{ feature.title }}</h4>
            <p class="text-xs text-slate-400">{{ feature.description }}</p>
          </li>
          <li *ngIf="features.length === 0" class="rounded-lg border border-slate-800/80 bg-black/20 p-4 text-xs text-slate-400">
            Für dieses Plug-in wurden noch keine Feature-Beschreibungen hinterlegt.
          </li>
        </ul>
      </div>

      <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 p-5">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-white">Konfiguration</h3>
          <button class="rounded bg-primary px-3 py-1 text-xs font-semibold text-white hover:bg-primary/80" (click)="saveConfig()">
            Speichern
          </button>
        </div>
        <textarea
          [(ngModel)]="configEditor"
          class="mt-3 h-52 w-full rounded-xl border border-slate-800 bg-black/40 px-4 py-3 font-mono text-xs text-slate-100"
        ></textarea>
      </div>

      <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 p-5">
        <h3 class="text-lg font-semibold text-white">Logstream</h3>
        <div class="mt-3 h-64 overflow-y-auto rounded-xl border border-slate-900 bg-black/40 p-3 font-mono text-xs text-slate-100 space-y-1">
          <div *ngFor="let log of logs" class="flex gap-3">
            <span class="text-slate-500">{{ log.timestamp | date: 'mediumTime' }}</span>
            <span
              class="uppercase"
              [ngClass]="{
                'text-emerald-300': log.level === 'info',
                'text-amber-300': log.level === 'warn',
                'text-rose-300': log.level === 'error'
              }"
            >
              {{ log.level }}
            </span>
            <span class="text-slate-100">{{ log.message }}</span>
          </div>
          <p *ngIf="logs.length === 0" class="text-xs text-slate-500">Noch keine Logeinträge empfangen.</p>
        </div>
      </div>
    </section>
  </div>
</div>

<ng-template #selectPlugin>
  <div class="rounded-2xl border border-slate-800/80 bg-slate-950/80 p-10 text-center text-slate-300">
    <h2 class="text-xl font-semibold text-white">Wähle ein Plug-in</h2>
    <p class="mt-2 text-sm">Besuche die <a routerLink="/plugins" class="text-primary">Übersicht</a>, um ein Plug-in-Dashboard zu öffnen.</p>
  </div>
</ng-template>
